package controller;

import model.Employee;
import service.EmployeeService;
import service.impl.EmployeeServiceImpl;
import util.UiKit;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;

public class ManageEmployeesUi extends JFrame {
    private static final long serialVersionUID = 1L;
    private final JFrame back;
    private final EmployeeService svc = new EmployeeServiceImpl();
    private JTable table; private DefaultTableModel model;

    public ManageEmployeesUi(JFrame back){
        this.back=back;
        setSize(640, 420); setLocationRelativeTo(null); setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE); setLayout(null);
        UiKit.attachClockToTitle(this, "員工管理"); UiKit.createBackButton(this, e -> { back.setVisible(true); dispose(); });

        String[] cols={"代碼","姓名","管理員","在職"}; model=new DefaultTableModel(cols,0){ @Override public boolean isCellEditable(int r,int c){ return false; } };
        table=new JTable(model); JScrollPane sp=new JScrollPane(table); sp.setBounds(20,50,580,260); add(sp);

        JButton btnAdd=new JButton("新增員工"); btnAdd.setBounds(20,320,120,28); add(btnAdd);
        JButton btnFire=new JButton("開除員工"); btnFire.setBounds(160,320,120,28); add(btnFire);

        btnAdd.addActionListener(e -> addEmp());
        btnFire.addActionListener(e -> fireEmp());

        reload();
    }

    private void reload(){
        model.setRowCount(0);
        for (Employee e : svc.list()){
            model.addRow(new Object[]{e.getEmpCode(), e.getEmpName(), e.isAdmin()?"是":"否", e.isActive()?"在職":"離職"});
        }
    }

    private void addEmp(){
        JTextField fCode=new JTextField();
        JTextField fName=new JTextField();
        JCheckBox chkAdmin=new JCheckBox("是管理員");
        Object[] msg={"員工代碼：",fCode,"員工姓名：",fName, chkAdmin};
        if (JOptionPane.showConfirmDialog(this,msg,"新增員工",JOptionPane.OK_CANCEL_OPTION)==JOptionPane.OK_OPTION){
            if (fCode.getText().trim().isEmpty()||fName.getText().trim().isEmpty()){ JOptionPane.showMessageDialog(this,"請輸入代碼與姓名"); return; }
            Employee e=new Employee();
            e.setEmpCode(fCode.getText().trim());
            e.setEmpName(fName.getText().trim());
            e.setAdmin(chkAdmin.isSelected());
            try { svc.add(e); reload(); } catch (Exception ex){ JOptionPane.showMessageDialog(this, ex.getMessage()); }
        }
    }

    private void fireEmp(){
        int r=table.getSelectedRow(); if (r<0){ JOptionPane.showMessageDialog(this,"請選取員工"); return; }
        String code=(String)model.getValueAt(r,0);
        svc.fire(code);
        reload();
    }
}
