package controller;

import model.Employee;
import service.FundService;
import service.impl.FundServiceImpl;
import util.UiKit;

import javax.swing.*;

public class AdminPanel extends JFrame {
    private static final long serialVersionUID = 1L;

    private final Employee adminEmp;
    private final JFrame employeeBackFrame;
    private JLabel lblBalance;
    private final FundService fundSvc = new FundServiceImpl();

    public AdminPanel(Employee adminEmp, JFrame employeeBackFrame) {
        this.adminEmp = adminEmp;
        this.employeeBackFrame = employeeBackFrame;
        buildUi();
    }

    private void buildUi() {
        setSize(900, 360);
        setLocationRelativeTo(null);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(null);
        UiKit.attachClockToTitle(this, "管理員面板 - " + adminEmp.getName() + "（" + adminEmp.getEmpCode() + "）");
        UiKit.createBackButton(this, e -> { if (employeeBackFrame!=null) employeeBackFrame.setVisible(true); dispose(); });

        lblBalance = new JLabel("公司資金餘額：$" + fundSvc.getBalance());
        lblBalance.setBounds(110, 10, 300, 24); add(lblBalance);

        JButton btnProcure   = new JButton("採購進貨");     btnProcure.setBounds(20, 50, 120, 28); add(btnProcure);
        JButton btnHire      = new JButton("新增員工");     btnHire.setBounds(150, 50, 120, 28); add(btnHire);
        JButton btnFire      = new JButton("開除員工");     btnFire.setBounds(280, 50, 120, 28); add(btnFire);
        JButton btnPayroll   = new JButton("薪資結清");     btnPayroll.setBounds(410, 50, 120, 28); add(btnPayroll);
        JButton btnReport    = new JButton("報表與分析");   btnReport.setBounds(540, 50, 120, 28); add(btnReport);
        JButton btnLogoutAll = new JButton("登出到主選單"); btnLogoutAll.setBounds(670, 50, 160, 28); add(btnLogoutAll);

        btnProcure.addActionListener(e -> new ProcurementUi(this::refreshBalance).setVisible(true));
        btnHire.addActionListener(e -> new HireEmployeeUi().setVisible(true));
        btnFire.addActionListener(e -> new FireEmployeeUi().setVisible(true));
        btnPayroll.addActionListener(e -> new PayrollSettlementUi(this::refreshBalance).setVisible(true));
        btnReport.addActionListener(e -> new AdminReportDashboard(this).setVisible(true));
        btnLogoutAll.addActionListener(e -> { new RoleSelector().setVisible(true); dispose(); });
    }

    private void refreshBalance(){ lblBalance.setText("公司資金餘額：$" + fundSvc.getBalance()); }
}
